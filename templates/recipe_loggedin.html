{% extends 'loggedin.html' %} {% block content %}

<div class="row">
  <div class="col s6">
    <h2>{{ recipe.recipe_name }}</h2>
  </div>
  <div class="col s6">
    {% if not user.favourites %}
    <button
      class="btn waves-effect waves-light"
      type="submit"
      name="action"
      onclick="add_favourite('{{recipe.recipe_name}}')"
    >
      Add to Favourites!
      <i class="material-icons right">playlist_add</i>
    </button>
    {% else %}
     
     {% if recipe.recipe_name.lower() in user.favourites %}
    <button class="btn waves-effect waves-light" type="submit" name="action" onclick="remove_favourite('{{recipe.recipe_name}}')">
      Remove from Favourites
      <i class="material-icons right">playlist_remove</i>
    </button>
    
    {% else %}
    <button
      class="btn waves-effect waves-light"
      type="submit"
      name="action"
      onclick="add_favourite('{{recipe.recipe_name}}')"
    >
      Add to Favourites?
      <i class="material-icons right">playlist_add</i>
    </button>
    {% endif %}
    {% endif %}
  </div>
</div>

<h5>Added by - {{ recipe.added_by }}</h5>

<p>Cooking time - {{ recipe.cooking_time }} mins</p>

<p>Difficulty - {{ recipe.difficulty }}</p>
<table>
  <tr>
    <td><strong>Ingredients </strong></td>
    <td><strong>Quantity </strong></td>
  </tr>
  {% for ingredient, quantity in recipe.ingredients %}
  <tr>
    <td>{{ ingredient }}</td>
    <td>{{ quantity}}</td>
  </tr>

  {% endfor %}
</table>
<p>{{ recipe.method }}</p>

<script>
  function add_favourite(recipe_name){
      let urlFor;
      let toastMessage;
      {% if 'username' in session %}
          urlFor = "{{url_for('add_favourite', recipe_name='fake_name')}}".replace('fake_name', recipe_name)
          toastMessage = "Recipe added to your favourites"
          alert(toastMessage);
      {% else %}
          toastMessage = "Please login or register to add recipes to your favourites"
          alert(toastMessage);

      {% endif %}
      $.ajax({type:'POST', url: urlFor}).done(function(){
      });
  }
  function remove_favourite(recipe_name){
      console.log("removing")
      let urlFor;
      let toastMessage;
        urlFor = "{{url_for('remove_favourite', recipe_name='fake_name')}}".replace('fake_name', recipe_name)
        toastMessage = "Recipe removed from favourites"
      $.ajax({type:'POST', url: urlFor}).done(function(){
      });
  }
</script>
{% endblock %}
