{% extends 'loggedin.html' %} {% block content %}

<div class="row">
  <div class="col s6">
    <h4 class="section-header">{{ recipe.recipe_name }}</h4>
  </div>
  <div class="col s6">
    {% if not user.favourites %}
    <button
      class="btn waves-effect waves-light playlist"  name="action" onclick="add_favourite('{{recipe.recipe_name}}')"
    >
      Add Favourite
      <i class="material-icons right">playlist_add</i>
    </button>
    {% else %}
     
     {% if recipe.recipe_name in user.favourites %}
    <button class="btn waves-effect waves-light playlist orange" type="submit" name="action" onclick="remove_favourite('{{recipe.recipe_name}}')">
      Remove Favourite
      <br>
      <i class="material-icons center">cancel</i>
    </button>
    
    {% else %}
    <button
      class="btn waves-effect waves-light playlist" type="submit" name="action" onclick="add_favourite('{{recipe.recipe_name}}')"
    >
      Add Favourite
      <i class="material-icons right">playlist_add</i>
    </button>
    {% endif %}
    {% endif %}
  </div>
</div>

<h5>Added by - {{ recipe.added_by }}</h5>

<p>Cooking time - {{ recipe.cooking_time }} mins</p>

<p>Difficulty - {{ recipe.difficulty.capitalize() }}</p>
<table>
  <tr>
    <td><strong>Ingredients </strong></td>
    <td><strong>Quantity </strong></td>
  </tr>
  {% for ingredient, quantity in recipe.ingredients %}
  <tr>
    <td>{{ ingredient }}</td>
    <td>{{ quantity}}</td>
  </tr>

  {% endfor %}
</table>
<h4> Method </h4>
<ol>
{% for line in recipe.method %}
{% if line == '' %}
<br>
{% else %}
<li> {{line}} </li>
{% endif %}
{% endfor %}
</ol>
<script>
  function add_favourite(recipe_name){
      let urlFor;
      let toastMessage;
      {% if 'username' in session %}
          urlFor = "{{url_for('add_favourite', recipe_name='fake_name')}}".replace('fake_name', recipe_name)
          toastMessage = "Recipe added to your favourites"
          ;
      {% else %}
          toastMessage = "Please login or register to add recipes to your favourites"
          alert(toastMessage);

      {% endif %}
      $.ajax({type:'POST', url: urlFor}).done(function(){
          alert(toastMessage)
      });
  }
  function remove_favourite(recipe_name){
      let urlFor;
      let toastMessage;
        urlFor = "{{url_for('remove_favourite', recipe_name='fake_name')}}".replace('fake_name', recipe_name)
        toastMessage = "Recipe removed from favourites"
      $.ajax({type:'POST', url: urlFor}).done(function(){
          alert(toastMessage)
      });
  }
</script>
{% endblock %}
