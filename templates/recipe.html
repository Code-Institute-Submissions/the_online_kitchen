{% extends 'base.html' %} {% block content %}

<div class="row">
  <div class="col s6">
    <h2>{{ recipe.recipe_name }}</h2>
  </div>
  <div class="col s6">
      {% if not user %}
      <button class="btn waves-effect waves-light" type="submit" name="action" onsubmit="add_favourite('{{recipe.recipe_name}}')">
        Add to Favourites
        <i class="material-icons right">playlist_add</i>
      </button>
      {% else %}
      {% for item in user.favourites %}
      {% if item == recipe.recipe_name %}
      <button class="btn waves-effect waves-light" type="submit" name="action">
        Remove from Favourites
        <i class="material-icons right">playlist_remove</i>
      </button>
      {% else %}
      <button class="btn waves-effect waves-light" type="submit" name="action">
        Add to Favourites
        <i class="material-icons right">playlist_add</i>
      </button>
      {% endif %}
      {% endfor %}
      {% endif %}
  </div>
</div>

<h5>Added by - {{ recipe.added_by }}</h5>

<p>Cooking time - {{ recipe.cooking_time }} mins</p>

<p>Difficulty - {{ recipe.difficulty.capitalize() }}</p>
<table>
  <tr>
    <td><strong>Ingredients </strong></td>
    <td><strong>Quantity </strong></td>
  </tr>
  {% for ingredient, quantity in recipe.ingredients %}
  <tr>
    <td>{{ ingredient }}</td>
    <td>{{ quantity}}</td>
  </tr>

  {% endfor %}
</table>
<h5>Method</h5>
<ol>
{% for item in recipe.method %}
{% if item == '' %}
<br>
{% else %}
<li> {{item}} </li>
{% endif %}
{% endfor %}
</ol>
<script>
function add_favourite(recipe_name){
    let urlFor;
    let toastMessage;
    {% if 'username' in session %}
        urlFor = "{{url_for('add_favourite', recipe_name='fake_name', username='fake_username')}}".replace('fake_name', recipe_name).replace('fake_username', session["username"])
        toastMessage = "Recipe added to your favourites"
        M.toast({html: toastMessage});
    {% else %}
        toastMessage = "Please login or register to add recipes to your favourites"
        M.toast({html: toastMessage});

    {% endif %}
    $.ajax({type:'POST', url: urlFor}).done(function(){
        M.toast({html: toastMessage});
    });
}
</script>
{% endblock %}
